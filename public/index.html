<!-- HTML code for the frontend -->
<script>
  $(document).ready(function() {
    let selectedFiles = [];

    // Add file to the list
    $('#addFileBtn').on('click', function() {
      const fileInput = $('#fileInput')[0];
      const errorDiv = $('#error');
      
      if (fileInput.files.length === 0) {
        errorDiv.text('Please select at least one file to add.');
        return;
      }
      
      errorDiv.text('');
      
      // Add the selected files to the array and update the UI
      for (let file of fileInput.files) {
        selectedFiles.push(file);
        $('#fileList').append(`
          <div class="file-item">
            <span>${file.name}</span>
            <button onclick="removeFile('${file.name}')">X</button>
          </div>
        `);
      }

      // Clear the file input
      $('#fileInput').val('');
    });

    // Remove a file from the list
    window.removeFile = function(fileName) {
      selectedFiles = selectedFiles.filter(file => file.name !== fileName);
      $(`#fileList div:contains(${fileName})`).remove();
    };

    // Merge PDFs
    $('#mergeBtn').on('click', async function() {
      const errorDiv = $('#error');
      const loadingSpinner = $('#loading');
      const downloadLinkDiv = $('#downloadLink');
      errorDiv.text('');
      loadingSpinner.removeClass('d-none');
      downloadLinkDiv.empty();

      const formData = new FormData();
      selectedFiles.forEach(file => {
        formData.append('files', file);
      });

      try {
        const response = await fetch('/api/merge-pdfs', {
          method: 'POST',
          body: formData,
        });

        const result = await response.json();
        
        if (response.ok) {
          // If the request is successful, show the download link
          downloadLinkDiv.html(`<a href="${result.downloadUrl}" class="btn btn-success">Download Merged PDF</a>`);
        } else {
          // Show error message from the backend
          errorDiv.text(result.error || 'An error occurred while merging the PDFs.');
        }
      } catch (error) {
        console.error('Error during API request:', error);
        errorDiv.text('An error occurred while merging the PDFs.');
      }

      loadingSpinner.addClass('d-none');
    });

    // Clear all files
    $('#clearAllBtn').on('click', function() {
      selectedFiles = [];
      $('#fileList').empty();
    });
  });
</script>
