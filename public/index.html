<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Merge multiple PDFs into a single document online. Free, fast, and easy to use.">
    <title>PDF Merger Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .file-input-container {
            display: flex;
            flex-direction: column;
        }
        .file-list {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .file-item {
            display: flex;
            align-items: center;
            background-color: #f8f9fa;
            padding: 5px 10px;
            margin-right: 10px;
            margin-bottom: 5px;
            border-radius: 5px;
        }
        .file-item span {
            margin-right: 10px;
        }
        .file-item .remove-btn {
            cursor: pointer;
        }
        .btn-red {
            background-color: #dc3545;
            color: white;
        }
        .btn-green {
            background-color: #28a745;
            color: white;
        }
        .btn-blue {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">PDF Merger Tool</h1>
    <div class="alert alert-info text-center">Merge multiple PDFs into a single document!</div>

    <div class="file-input-container">
        <input type="file" id="fileInput" class="form-control" multiple accept="application/pdf">
        <div class="file-list" id="fileList"></div>
    </div>

    <button class="btn btn-blue" id="mergeBtn">Merge PDFs</button>
    <button class="btn btn-red" id="clearBtn">Clear All</button>

    <div id="error" class="text-danger mt-3"></div>

    <!-- Download link for the merged PDF will appear here -->
    <div id="downloadLink" class="mt-3" style="display: none;">
        <a href="#" id="downloadBtn" class="btn btn-green">Download Merged PDF</a>
    </div>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const mergeBtn = document.getElementById('mergeBtn');
    const clearBtn = document.getElementById('clearBtn');
    const errorDiv = document.getElementById('error');
    const downloadLinkDiv = document.getElementById('downloadLink');
    const downloadBtn = document.getElementById('downloadBtn');

    let selectedFiles = [];

    // Handle file selection
    fileInput.addEventListener('change', () => {
        const files = fileInput.files;
        for (const file of files) {
            if (!selectedFiles.some(f => f.name === file.name)) {
                selectedFiles.push(file);
                renderFileList();
            }
        }
    });

    // Render the selected files in the UI
    function renderFileList() {
        fileList.innerHTML = '';
        selectedFiles.forEach(file => {
            const fileItem = document.createElement('div');
            fileItem.classList.add('file-item');
            fileItem.innerHTML = `
                <span>${file.name}</span>
                <span class="remove-btn" onclick="removeFile('${file.name}')"><i class="bi bi-x-circle"></i></span>
            `;
            fileList.appendChild(fileItem);
        });
    }

    // Remove file from the list
    function removeFile(fileName) {
        selectedFiles = selectedFiles.filter(file => file.name !== fileName);
        renderFileList();
    }

    // Clear all selected files
    clearBtn.addEventListener('click', () => {
        selectedFiles = [];
        renderFileList();
        errorDiv.textContent = '';
        downloadLinkDiv.style.display = 'none';
    });

    // Merge PDFs
    mergeBtn.addEventListener('click', async () => {
        errorDiv.textContent = '';
        downloadLinkDiv.style.display = 'none'; // Hide download link initially

        if (selectedFiles.length === 0) {
            errorDiv.textContent = 'Please select at least one PDF.';
            return;
        }

        // Convert files to base64 strings
        const fileArray = [];
        for (const file of selectedFiles) {
            const reader = new FileReader();
            const promise = new Promise((resolve) => {
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.readAsDataURL(file);
            });
            fileArray.push(await promise);
        }

        try {
            const response = await fetch('/api/merge-pdfs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ files: fileArray }),
            });

            if (response.ok) {
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);

                // Show download link
                downloadLinkDiv.style.display = 'block';
                downloadBtn.href = url;  // Set the download link to the merged PDF
            } else {
                const error = await response.json();
                errorDiv.textContent = error.error || 'Failed to merge PDFs.';
            }
        } catch (error) {
            errorDiv.textContent = 'An unexpected error occurred.';
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
